<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Notes Dashboard</title>
  <style>
    * {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: "Poppins", sans-serif;
}

body {
  background: #f5f7fb;
  color: #333;
}

.dashboard {
  display: flex;
  height: 100vh;
}

/* Sidebar */
.sidebar {
  width: 230px;
  background: #1e293b;
  color: white;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 20px 10px;
}

.sidebar .profile img {
  width: 70px;
  border-radius: 50%;
  margin-bottom: 10px;
}

.sidebar .profile h3 {
  margin-bottom: 20px;
}

.sidebar nav ul {
  list-style: none;
  width: 100%;
}

.sidebar nav ul li {
  padding: 12px 20px;
  margin: 8px 0;
  border-radius: 8px;
  cursor: pointer;
  transition: 0.3s;
}

.sidebar nav ul li:hover,
.sidebar nav ul li.active {
  background: #334155;
}

/* Main content */
.main-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  position: relative;
}

.top-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 15px 25px;
  background: white;
  border-bottom: 1px solid #ddd;
}

.top-bar input {
  width: 60%;
  padding: 10px;
  border-radius: 8px;
  border: 1px solid #ccc;
}

.top-bar button {
  padding: 10px 20px;
  background: #2563eb;
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
}

.top-bar button:hover {
  background: #1d4ed8;
}

/* Notes Section */
.notes-area {
  padding: 20px;
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(230px, 1fr));
  gap: 20px;
  overflow-y: auto;
}

.note-card {
  background: white;
  padding: 15px;
  border-radius: 12px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  transition: transform 0.2s;
}

.note-card:hover {
  transform: scale(1.02);
}

/* Floating Create Note Button */
.create-note-btn {
  position: absolute;
  bottom: 30px;
  right: 30px;
  width: 60px;
  height: 60px;
  background: #10b981;
  color: white;
  border: none;
  border-radius: 50%;
  font-size: 2rem;
  cursor: pointer;
  box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  transition: 0.3s;
}

.create-note-btn:hover {
  background: #059669;
}
#note{
  display: none;
}
#noteContainer{
  display: none;
  padding-left: 200px;
}
#noteContainer input{
  border: 1px solid  #ddd;
    width: 500px;
  height: 40px;
  border-radius: 5px;

}
#noteContainer .content{
   width: 500px;
  height: 100px;
}
#noteContainer input:hover{
border: 1px solid black;
}
 .buttonsave{
  width: 200px;
  height: 40px;
 background: #10b981;
  color: white;
  border: none;
  border-radius: 10px;
  font-size: 1rem;
  cursor: pointer;
  box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  transition: 0.3s;
}
.buttonsave:hover{
  background: #059669;
}
/* ===== Note Cards Styling ===== */
#notes {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
  gap: 20px;
  margin-top: 20px;
  padding: 10px;
}

.note-card {
  background: rgba(255, 255, 255, 0.9);
  border-radius: 15px;
  padding: 20px;
  box-shadow: 0 6px 15px rgba(0,0,0,0.1);
  border-left: 5px solid #2563eb;
  transition: all 0.3s ease;
  cursor: pointer;
  position: relative;
  overflow: hidden;
}

/* Hover effect */
.note-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 20px rgba(0,0,0,0.15);
  border-left-color: #10b981;
}

/* Title */
.note-title {
  font-size: 1.2rem;
  font-weight: 600;
  color: #1e3a8a;
  margin-bottom: 10px;
  border-bottom: 1px solid #e5e7eb;
  padding-bottom: 5px;
}

/* Content */
.note-content {
  font-size: 0.95rem;
  color: #374151;
  line-height: 1.5;
  margin-bottom: 15px;
  word-wrap: break-word;
}

/* Author */
.note-author {
  font-size: 0.9rem;
  font-weight: 500;
  color: #10b981;
  text-align: right;
}

/* Smooth fade-in animation for new notes */
@keyframes fadeInCard {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.note-card {
  animation: fadeInCard 0.3s ease-in-out;
}
#profile {
  display: flex;
  justify-content: center;
  align-items: center;
  margin-top: 25px;
}
.profile-card {
  background: #fff;
  border-radius: 12px;
  padding: 20px 25px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  width: 280px;
  text-align: left;
  transition: 0.3s ease;
}
.profile-card:hover {
  transform: scale(1.02);
}
.profile-username, .profile-email, .profile-role {
  margin: 8px 0;
  font-size: 15px;
  color: #333;
}
.profile-username strong,
.profile-email strong,
.profile-role strong {
  color: #1e40af;
}
  </style>
</head>
<body>

  <div class="dashboard">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="profile">
        <h3 id="profileName">User</h3>
      </div>
      <nav>
        <ul>
          <li class="active" onclick="allNotes()">ðŸ“˜ All Notes</li>
          <li onclick="profileId()">ðŸ‘¤ Profile</li>
          <li onclick="logout()">ðŸšª Logout </li>
          <li onclick="delAcc()">Delete Account</li>
          <li onClick="aiHelper"> Ai Helper</li>
        </ul>
      </nav>
    </aside>

    <main class="main-content">
      <header class="top-bar">
        <input type="text" placeholder="Search notes..." id="search">
        <button id="login" onclick="login()">Login</button>
      </header>

      <section class="notes-area">
        <div id="notes"></div>
        <div id="profile"></div>
       <div id="noteContainer">
      <input type="text" class="title" placeholder="Title">
      <br>
      <br>
      <input type="text" class="content" placeholder="Content">
      <br>
      <br>
      <input type="text" class="author" placeholder="Author">
      <br>
      <br>
      <button class="buttonsave" onclick="savedNotes()">Save</button>
      <br>
       <br> 
       <br>
       <p id="message" style="width:500px; padding-left:200px;"></p>
       </div>
        
      </section>
    </main>
    <button class="create-note-btn" onclick= "createNotes()" title="Create New Note">+</button>
 
  </div>
  <ul id="notesList">

  </ul>
</body>
<script>

async function delAcc(){
  const token =  localStorage.getItem('token')
if(!token) {
  console.log('token not provided')
  showMessage('token not provide', 'red')
}
try{
 const response =await fetch('http://localhost:5000/user',{
     method:'DELETE',
headers:{
  "Content-Type" : "application/json",
   'Authorization': `Bearer ${token}`
 }
 })
 const res =await response.json()
 if(response.ok){
  console.log('account deleted',res.data)
  showMessage('account deleted successfully','red')
  window.location.href = 'signup.html'
 }
}catch(error){
console.log('internal server error',error)
showMessage('internal server error',error.message)
 }
}
      function showMessage(mesg,color){
      const message = document.getElementById('message')
      message.textContent = mesg
      message.style.color = color
    }
    function login(){
      window.location.href = 'login.html'
    }
    function createNotes(){
     document.getElementById('noteContainer').style.display='block'
    }
   
   async function savedNotes(){
      const title = document.querySelector(".title").value
      console.log(title)
      const content = document.querySelector(".content").value
      console.log(content)
      const author = document.querySelector(".author").value
      console.log(author)
      if(!title||!content||!author){
        showMessage('please fill all fields','red') 
        return
      }
      const token = localStorage.getItem("token")
      if(!token){
        console.log('you have not login yet')
        showMessage("you have not login yet",'red')
      }
      try{
      const response =await fetch('http://localhost:5000/note',{
     method:'POST',
headers:{
  "Content-Type" : "application/json",
   'Authorization': `Bearer ${token}`
},
body: JSON.stringify({
    title:title,
    content:content,
    author:author
   
})
      })
      const res =await response.json()
      if(response.ok){
        console.log('notes created successfully',response)
        showMessage(res.message||'notes created successfully',"green")
         
      }else{
        console.log('something went wrong')
        showMessage(res.message||'something went wrong','red')
      }
  
    }catch(error){
      console.log('something went wrong',error)
      showMessage(res.message||'internal server error','red')
    }
    } 
async function allNotes(){
  try{
    const token = localStorage.getItem('token')
    if(!token){
      console.log('token not received')
      showMessag('token not received','red')
    }
  const response = await fetch('http://localhost:5000/note',{
     method:'GET',
headers:{
  "Content-Type" : "application/json",
 'Authorization': `Bearer ${token}`
}
  })
  const res = await response.json()
  if(response.ok){
    console.log('your note here',res.data)
    showMessage(res.message||'you notes here','green')
    displayNotes(res.data)
  }else{
    console.log('you will not get notes')
    showMessage('you will not get notes','red')
  }
}catch(error){
console.log('internal server error',error)
showMessage(error||'internal server error','red')
}
}
function logout(){
  
  const token = localStorage.removeItem('token')
  setTimeout(()=>{
    window.location.href = 'login.html'
  },1000)
}
async function profileId(){
  try{
const token = localStorage.getItem('token')
if(!token){
  console.log('token not found')
  showMessage('notes not found','red')
}
  const response = await fetch('http://localhost:5000/user/profile/personal',{
    method:'GET',
    headers:{
  "Content-Type" : "application/json",
 'Authorization': `Bearer ${token}`
    }
  })
  const res =await response.json()
  if(response.ok){
    console.log('profile fetched',res)
    showMessage(res.message||'your notes here','green')
   displayProfile(res.user)
  }else{
    console.log('token not provided')
    showMessage('profile not found','red')
  }

}catch(error){
console.log('internal server error',error)
showMessage('soemthing went wrong','red')
}
}
function displayNotes(notes){
  const container = document.getElementById('notes');
  container.innerHTML = '';

  if(!notes || notes.length === 0){
    container.innerHTML = '<p>No notes found.</p>';
    return;
  }

  notes.forEach(note => {
    const div = document.createElement('div');
    div.classList.add('note-card');
    div.innerHTML = `
      <div class="note-title">${note.title || 'Untitled Note'} <button onclick="updateNote()" style="border:2px solid black; border-radius:20%"; pointer:cursor;> #?</button> </div>
      <div class="note-content">${note.content || note.description || 'No content available'}</div>
      <div class="note-author">${note.author || 'No author available'}</div>
    `;

    container.appendChild(div);
  });
} 

    function displayProfile(profile){
            const container = document.getElementById('profile');
      container.innerHTML = '';

      if(!profile||Object.keys(profile).length === 0){
        container.innerHTML = '<p> No profile found </p>';
        return;
      }
        const div = document.createElement('div'); 
        div.classList.add('profile-card');
        div.innerHTML = `
          <div class="profile-email">${profile.email} <button onClick="updateUsername()" style="border:1px solid black; cursor:pointer ; border-radius:50% ; font-size:15px">Edit</button></div>
          <div class="profile-username">${profile.username}</div>
          <div class="profile-role">${profile.role }</div>
        `;
        container.appendChild(div);
      ;
    }
    function updateUsername(){
      window.location.href = 'update.html'
    }

    const searchBlock = document.getElementById('search')
    searchBlock.addEventListener('keydown',async function search(e){
      try{
      if(e.key === "Enter"){
        const query = searchBlock.value.trim()
        const token = localStorage.getItem('token')
        console.log(query)
        if(!query){
          console.log('please type for seach notes')
          showMessage('please type something for notes','red')
        }else if(!token){
          console.log('token not provide')
        }
      const response = await fetch(`http://localhost:5000/note/search?query=${query}`,{
    method:'GET',
    headers:{
  "Content-Type" : "application/json",
 'Authorization': `Bearer ${token}`
    }
  })
  const res = await response.json()
  if(response.ok){
    console.log('notes searched')
    displayNotes(res)
    showMessage('searched notes is here','green')
  }else{
    showMessage(res.message||'no notes to search','red')
  }
      }
    }catch(error){
console.log('something went wrong',error)
showMessage(error.message||'internal server error','red')
    }
    })
    async function updateNote(noteId){
      try{
           const token  = localStorage.getItem('token')
           console.log(token)
           if(!token){
            console.log("token not provide")
           }
       const response = await fetch(`http://localhost:5000/note/update/${noteId}`,{
    method:'PUT',
    headers:{
  "Content-Type" : "application/json",
 'Authorization': `Bearer ${token}`
    }
  })
      }catch(error){
        console.log("something went wrong",error)
        showMessage(error.message||"internal server error","red")
      }
    }
     function showUserName() {
  const name = localStorage.getItem("username");
  if (name) {
    document.getElementById("profileName").textContent = name;
  }
}
window.onload = showUserName
    
</script>
</html>

