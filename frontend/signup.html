<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Signup with OTP</title>
  <style>
    /* ðŸŽ¨ Reset and base styling */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Poppins", Arial, sans-serif;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: linear-gradient(135deg,black,white);
    }

    .container {
      background: #fff;
      padding: 30px 40px;
      border-radius: 16px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
      width: 350px;
      text-align: center;
      transition: 0.3s ease-in-out;
    }

    .container:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.25);
    }

    h2 {
      color: #2d3436;
      margin-bottom: 20px;
    }

    input {
      width: 100%;
      margin: 8px 0;
      padding: 12px;
      border: 1.5px solid #dcdde1;
      border-radius: 10px;
      outline: none;
      font-size: 14px;
      transition: 0.2s;
    }

    input:focus {
      border-color: #6c5ce7;
      box-shadow: 0 0 6px rgba(108, 92, 231, 0.4);
    }

    button {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      border: none;
      border-radius: 10px;
      background: linear-gradient(135deg, #6c5ce7, #0984e3);
      color: white;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: 0.3s;
    }

    button:hover {
      background: linear-gradient(135deg, #0984e3, #6c5ce7);
      transform: scale(1.03);
    }

    #message {
      margin-top: 15px;
      font-size: 14px;
      font-weight: 500;
      color: #2d3436;
    }
    #login{
      color: rgb(14, 157, 240);
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      
    }

    @media (max-width: 400px) {
      .container {
        width: 90%;
        padding: 25px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Signup (OTP Verification)</h2>

    <input type="text" id="username" placeholder="Enter username">
    <input type="email" id="email" placeholder="Enter email">
    <input type="password" id="password" placeholder="Enter password">
    <input type="text" id="role" placeholder="Enter role (optional)">

    <button onclick="sendOtp()">Send OTP</button>

    <input type="text" id="otp" placeholder="Enter received OTP">
    <button onclick="verifyOtp()">Verify & Signup</button>

    <p id="message"></p>
    <p onclick="login()" id="login">login</p>
  </div>

  <script>
    function showMessage(mesg,color){
      const message = document.getElementById('message')
      message.textContent = mesg
      message.style.color = color
    }
    
    async function sendOtp(){
let userInput = document.getElementById("username").value.trim()
 let emailInput = document.getElementById("email").value.trim()
 let passwordInput = document.getElementById("password").value.trim()
 let roleInput = document.getElementById("role").value.trim()
 console.log(userInput,emailInput,passwordInput,roleInput)
 if(!userInput||!emailInput||!passwordInput||!roleInput){
  return showMessage('please fill all the fields', 'red')
 }
 try{
const response =await  fetch("http://localhost:5000/user/signup-otp",{
  method:'POST',
headers:{
  "Content-Type" : "application/json"
},
body: JSON.stringify({
  username:userInput,
  email:emailInput,
  password:passwordInput,
  role:roleInput
})
})
console.log(response)
const res = await response.json()
console.log(res)
if(response.ok){
   console.log('otp is sent')
 return showMessage(res.message|| 'otp is sent to your gmail', 'green')
}else{
  return showMessage(res.message|| 'please enter valid email','red')
  console.log('Failed to sent to otp')
  
}

 }catch(error){
   console.log('server error',error)
  return showMessage("internal server error",'red')
 
 }

    }
    
    function clearForm(){
  let userInput = document.getElementById("username").value= ""
 let emailInput = document.getElementById("email").value = ""
 let passwordInput = document.getElementById("password").value = ""
 let roleInput = document.getElementById("role").value = ""
    }

    async function verifyOtp(){
const emailInput = document.getElementById('email').value.trim()
console.log(emailInput)
const otpInput = document.getElementById('otp').value.trim()
console.log(otpInput)
try{
const response =await fetch("http://localhost:5000/user/verify-otp",{
   method:'POST',
headers:{
  "Content-Type" : "application/json"
},
body: JSON.stringify({
   email : emailInput,
   otp : otpInput
})
})

const res = await response.json()
if(response.ok){
  console.log('you signup successfully')
 return showMessage(res.message||'you signup succesfully','green')

}else{
  console.log('invalid otp or email')
 return showMessage(res.message||'invalid otp and email','red')
  
}
}catch(error){
console.log('server error',error)
return showMessage('internal server error','red')
  
}
    }
    function login(){
      window.location.href = 'login.html'
    }

  </script>
</body>
</html>
